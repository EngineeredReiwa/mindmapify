# Mindmapify MVP実装ロードマップ

## 🎯 実装戦略

### 段階的アプローチ
- 各フェーズ完了時に動作確認
- 最小機能で先に進み、後で改善
- 型安全性を最優先

### 技術的重点
- 状態の不変性（Zustand + immer）
- レンダリング最適化（React.memo）
- イベントハンドリングの効率化

## 📋 実装フェーズ

### 🏗️ フェーズ1: 基盤構築（1-2日）
**目標**: データとキャンバスの基本構造

#### タスク1: 状態管理基盤構築
- [x] TypeScript型定義（Node, Connection, MindmapState）
- [x] Zustand store設計とセットアップ
- [x] 基本的なアクション（addNode, updateNode等）

**成功条件**: 型安全な状態管理ができる ✅

#### タスク2: Konvaキャンバス基本実装
- [x] Konva Stage/Layer構造
- [x] ズーム・パン機能
- [x] レスポンシブ対応

**成功条件**: 空のキャンバスが正常表示・操作できる ✅

### 🎯 フェーズ2: ノード操作（2-3日）
**目標**: ノードの作成・編集機能

#### タスク3: ノード作成機能
- [x] ツールバー「New Node」ボタンで新ノード生成
- [x] 視覚的フィードバック（選択状態、ホバー効果）
- [x] ドラッグ移動機能（座標変換問題修正済み）
- [x] キャンバスパン操作との競合状態解決

**成功条件**: ツールバーボタンでノードが出現し、正確にドラッグ移動できる ✅

#### タスク4: ノード編集機能
- [x] ダブルクリックでテキスト編集
- [x] インライン編集UI
- [x] リアルタイム更新

**成功条件**: ノードのテキストが編集できる ✅

### 🔗 フェーズ3: 接続とコード生成（2-3日）
**目標**: マインドマップの構造化

#### タスク5: ノード接続機能（修正版完成）
- [x] ノードに接続点を作成（常時表示）
- [x] 接続点をクリック&ドラッグ時に点線矢印を表示
- [x] 接続点固定位置（ドラッグで動かない）
- [x] 点線矢印を他ノードの接続点でドロップ時に実線接続に変換
- [x] 接続線の描画とアニメーション
- [x] 接続状態の管理
- [x] ノードID抽出ロジック修正（UUID完全対応）

**成功条件**: 接続点ドラッグで点線矢印表示、ドロップで実線接続作成 ✅

#### タスク6: Mermaidコード生成（ロジックツリー対応完成）
- [x] ノード構造→Mermaid構文変換（基本実装）
- [x] リアルタイム更新
- [x] サイドパネル表示
- [x] コピーボタン機能
- [x] 接続構造を含む完全なマインドマップコード生成
- [x] ルートノードの自動識別（最多接続ノード）
- [x] 階層構造の自動生成（再帰的構築）
- [x] リアルタイム更新の最適化（useMemoでメモ化）
- [x] 未接続ノードの処理
- [x] テキストクリーニング処理
- [x] Flowchart記法対応（ループ表現可能）
- [x] 関係性ラベル機能（12種類のプリセット）
- [x] 接続線ダブルクリックでラベル編集
- [x] ラベル付きFlowchartコード生成

**成功条件**: 論理関係を含むMermaid Flowchartコードが正確に生成される ✅

### ⚡ フェーズ4: 操作性向上（1-2日）
**目標**: 実用的で直感的な機能完成

#### 🎯 Phase 4A: 緊急UX改善（優先度：高）
**基本操作の改善** - ユーザビリティの根本的問題を解決

##### タスク7A: 視覚的改善
- [x] 矢印ヘッド表示の修正（方向性の明確化）
- [x] 接続線の視覚的改善（太さ、色、スタイル）

**成功条件**: 矢印の方向が一目で分かる ✅

##### タスク7B: ノード編集の改善
- [x] ノード内直接編集（別テキストボックス廃止）
- [x] テキスト自動折り返し（ノード縦長対応）
- [x] ノードサイズの動的調整

**成功条件**: ノード内で快適にテキスト編集ができる ✅

#### 🎯 Phase 4B: 操作性向上（優先度：中）
**編集機能の拡充** - より効率的な操作を実現

##### タスク8A: 削除・選択機能
- [x] Undo/Redo履歴管理（基本実装済み）
- [x] Clearボタン（全削除機能）
- [ ] 個別ノード削除（Delete キー）
- [ ] ノード選択状態の改善
- [ ] 接続線選択・削除の改善

**成功条件**: 直感的な削除・選択操作ができる

#### 🎯 Phase 4C: 将来的改善（優先度：低）
**高度な機能** - より豊富な機能を提供

##### タスク8B: 高度な編集機能
- [ ] コピー・ペースト機能
- [ ] 複数選択機能
- [ ] グループ化機能

##### タスク8C: システム改善
- [ ] パフォーマンス最適化
- [ ] エラーハンドリング
- [ ] アクセシビリティ改善

**成功条件**: スムーズで直感的な操作感

## 🚀 マイルストーン進捗

### ✅ フェーズ1完了: 基盤構築
**目標**: 「ツールバーボタンでノード作成・移動」達成済み
- ✅ 空のキャンバス表示
- ✅ ツールバーでノード作成
- ✅ ドラッグ移動（座標問題修正済み）
- ✅ 基本的なMermaidコード生成

### ✅ フェーズ2完了: ノード操作
**目標**: 「ダブルクリックでテキスト編集」達成済み
- ✅ ノード作成・編集・移動の基本操作
- ✅ インライン編集UI
- ✅ テキスト入力とリアルタイム更新

### ✅ フェーズ3完了: 接続とコード生成
**目標**: 「論理関係を含むMermaid Flowchartコードが正確に生成される」達成済み
- ✅ 常時表示接続点システム
- ✅ 点線プレビュー → 実線接続変換
- ✅ 関係性ラベル機能（12種類プリセット）
- ✅ Flowchart記法対応（ループ表現可能）
- ✅ ロジックツリー構造の自動生成

### ✅ Phase 4A完了: 緊急UX改善
**目標**: 「基本操作の根本的問題解決」達成済み
- ✅ 矢印方向の明確化（三角形矢印ヘッド実装）
- ✅ ノード内直接編集（テキストエリア改善）
- ✅ テキスト自動折り返し（動的ノードサイズ対応）

### 🔄 現在のマイルストーン: Phase 4B 操作性向上
**次の目標**: 「編集機能の拡充」
- 個別ノード削除機能
- ノード選択状態の改善
- 接続線選択・削除の改善

## 🎯 現在の機能概要

### ✅ 実装済み機能
- **ノード操作**: ツールバーでの作成、ドラッグ移動、ダブルクリック編集
- **接続システム**: 常時表示接続点、点線プレビュー、実線接続
- **関係性ラベル**: 12種類プリセット（具体例、根拠、結果、同類、詳細、原因、手段、対比、解決策、前提、要素、補完）
- **コード生成**: Mermaid Flowchart記法、ループ対応、ラベル付き矢印
- **UI/UX**: レスポンシブキャンバス、リアルタイム更新、履歴管理（Undo/Redo）

### ✅ Phase 4A で解決済みの問題
- **矢印方向不明**: 三角形矢印ヘッドで方向性を明確化済み
- **編集の煩雑さ**: ノード内直接編集（テキストエリア）に改善済み
- **テキスト見切れ**: 自動折り返しと動的ノードサイズに改善済み

### 🎮 操作方法
1. **ノード作成**: ツールバー「New Node」ボタン
2. **ノード編集**: ダブルクリックでインライン編集（Ctrl+Enter保存、Esc取消）
3. **接続作成**: 接続点をドラッグ&ドロップ
4. **ラベル編集**: 接続線をダブルクリック
5. **コード取得**: サイドパネル「Copy」ボタン

## 📝 開発メモ

### 決定事項
- TypeScript strict mode使用
- Zustand + immer for 状態管理
- Konva for キャンバス描画
- react-konva-utils for HTML overlay
- Mermaid Flowchart記法採用（ループ対応）
- 関係性ラベル12種類プリセット
- 常時表示接続点システム
- Puppeteer for E2Eテスト自動化

### 注意点
- パフォーマンス: 50ノード超で仮想化検討
- Mermaidコード生成: useMemoでメモ化済み
- メモリリーク: useEffectクリーンアップ必須
- 座標変換: StageドラッグとNodeドラッグの競合解決済み
- UUID処理: 接続点IDの適切な分割が重要

### 🧪 テスト環境
- `npm run test:quick` - 5秒自動テスト（headless）
- `npm run test:debug` - ブラウザ表示テスト + スクリーンショット
- `npm run test:drag` - ドラッグ動作専用デバッグテスト

---

このロードマップは開発進行に合わせて更新します。
各タスク完了時にチェックボックスを更新してください。